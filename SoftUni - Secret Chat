using System;
using System.Linq;

namespace Problem_1___Secret_Chat
{
    class Program
    {
        static void Main(string[] args)
        {
            string message = Console.ReadLine();
            string command = Console.ReadLine();
            while (command != "Reveal")
            {
                // Превръщаме ги в масив и ще са равни на командата разделена от :|:
                string[] cmdTokens = command.Split(separator: ":|:");
                switch (cmdTokens[0])
                {
                    case "ChangeAll":
                        {
                            // Взимаме substring който трябва да бъде заменен
                            string substring = cmdTokens[1]; // V
                                                             // take the replacement string
                            string replacement = cmdTokens[2];
                            message = message.Replace(oldValue: substring, newValue: replacement);
                        }
                        break;
                    case "Reverse":
                        {
                            // Reverse = [0], {substring} = [1]
                            // Тогава substring = !gnil
                            // Ние запазваме substring
                            string substring = cmdTokens[1];
                            if (message.Contains(substring))
                            {
                                // Взимаме индексът където се съдържа този substring
                                // hellodar!gnil
                                int index = message.IndexOf(substring);
                                // Махаме го от текущото му място(Индексът на който се намира той, от началото до краят толквоа индекса)
                                message = message.Remove(index, count: substring.Length);
                                //За да можем да добавим substring обърнат
                                //
                                message = message + string.Join("", substring.Reverse());
                                // След изпълняване на командата reverse, substring се обръща и става hellodarling! 
                            }
                            else
                            {
                                // Ако го няма този индекс
                                Console.WriteLine("error");
                                // Вкарваме на ново командата
                                command = Console.ReadLine();
                                // За да отидем на следващата стъпка от нашият цикъл
                                continue;
                            }
                        break;
                        }
                    case "InsertSpace":
                        {
                            // Взимаме индексът [1] , защото го взимаме от първият индекс
                            int index = int.Parse(cmdTokens[1]);
                            message = message.Insert(index, value: " ");
                            break;
                        }
                }
                //Изписваме съобщението
                Console.WriteLine(message);
                command = Console.ReadLine();
            }
            Console.WriteLine($"You have a new text message: {message}");
        }
    }
}
